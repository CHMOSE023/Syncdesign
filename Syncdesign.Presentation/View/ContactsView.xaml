<UserControl x:Class="Syncdesign.Presentation.View.ContactsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Syncdesign.Presentation.View"
             xmlns:bim="http://bimhub.top/syncdesign/2026/xaml"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:beh="clr-namespace:Syncdesign.Presentation.Behavior"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <bim:ControlsDictionary/>
                <bim:ThemesDictionary/>
            </ResourceDictionary.MergedDictionaries>             
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid ClipToBounds="True">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <StackPanel  Grid.Row="0"  Background="Transparent">
            <Border BorderBrush="LightGray" BorderThickness=" 0 0 0 1" >
                <i:Interaction.Behaviors>
                    <beh:ScrollHeaderHideBehavior ScrollSpeed="30"/>
                </i:Interaction.Behaviors>
                <StackPanel  Background="Transparent">
                    <bim:Button Style="{StaticResource SyncdesignUiButton}"                  
                                    Margin="10 6 10 6"  
                                    Height="32"
                                    Background="#F5f5f5" 
                                    HoverBackground="#F2f2f2"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    BorderBrush="LightGray">

                        <StackPanel   Orientation="Horizontal"   HorizontalAlignment="Center" >
                            <bim:SymbolIcon FontSize="18"  Symbol="PersonSettings20"/>
                            <Label Content="好友管理器" Foreground="{Binding Foreground,  RelativeSource={RelativeSource AncestorType=bim:Button}}"/>
                        </StackPanel>
                    </bim:Button>
                    <bim:Button  Style="{StaticResource SyncdesignUiButton}"
                                     Height="32"
                                     Background="Transparent" 
                                     HoverBackground="#F2f2f2"
                                     CornerRadius="0"
                                     BorderThickness="0"
                                     BorderBrush="LightGray">
                        <Grid  Margin="10 0 10 0" >
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label  Content="好友通知"   
                                        VerticalAlignment="Center"   
                                        Foreground="{Binding Foreground,   RelativeSource={RelativeSource AncestorType=bim:Button}}"/>

                            <bim:SymbolIcon Grid.Column="1"
                                        FontSize="18"
                                        Symbol="ChevronRight20"
                                        VerticalAlignment="Center"/>
                        </Grid>
                    </bim:Button>
                    <bim:Button  Style="{StaticResource SyncdesignUiButton}"                   
                                     Height="32"
                                     CornerRadius="0"
                                     Background="Transparent" 
                                     HoverBackground="#F2f2f2"
                                     BorderThickness="0"
                                     BorderBrush="LightGray">

                        <Grid   Margin="10 0 10 0" >
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Content="项目通知"                     
                                       VerticalAlignment="Center"   
                                       Foreground="{Binding Foreground,   RelativeSource={RelativeSource AncestorType=bim:Button}}"/>

                            <bim:SymbolIcon Grid.Column="1"
                                                FontSize="18"
                                                Symbol="ChevronRight20"
                                                VerticalAlignment="Center"/>
                        </Grid>
                    </bim:Button>
                </StackPanel>
            </Border>

            <bim:Segmented Grid.Row="0"
                                 Margin ="9 6 9 6"
                                 ItemsSource="{Binding Tabs}" 
                                 SelectedItem="{Binding CurrentTab,Mode=TwoWay}"                           
                                 />

        </StackPanel>
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" >
            <ItemsControl ItemsSource="{Binding ContactView}">
                <ItemsControl.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.ContainerStyle>
                            <Style TargetType="GroupItem">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="GroupItem">
                                            <!-- GroupItem.DataContext = CollectionViewGroup -->
                                            <bim:SectionExpander>
                                                <!-- Header 绑定分组信息 -->
                                                <bim:SectionExpander.Header>
                                                    <Grid Margin=" 0 0 10 0">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <!-- 左侧：名称 -->
                                                        <TextBlock Text="{Binding Name}" 
                                                                   VerticalAlignment="Center"
                                                                   Foreground="#333"/>

                                                        <!-- 右侧：数量 -->
                                                        <TextBlock Grid.Column="1"
                                                                   Text="{Binding ItemCount, StringFormat='({0})'}"
                                                                   Margin="3,0,0,0"
                                                                   VerticalAlignment="Center"
                                                                   FontSize="11"
                                                                   Foreground="#999"/>
                                                    </Grid>
                                                </bim:SectionExpander.Header>
                                                
                                                <!-- 内容：分组内 Items -->
                                                <ItemsPresenter/>

                                            </bim:SectionExpander>

                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </GroupStyle.ContainerStyle>
                    </GroupStyle>
                </ItemsControl.GroupStyle>

                <!-- 普通 Item -->
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="Root"                               
                                Padding="2" 
                                Background="Transparent">

                            <Grid  Margin="15 2 2 2 ">
                                <Grid.ColumnDefinitions>    
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- 头像 -->
                                <Border Width="40"
                                        Height="40"
                                        CornerRadius="20">
                                    <Image Source="pack://application:,,,/Syncdesign.Ui;component/Resources/Images/avatar.jpg"
                                           Stretch="UniformToFill"
                                           RenderOptions.BitmapScalingMode="HighQuality">
                                        <Image.Clip>
                                            <EllipseGeometry Center="20,20"
                                             RadiusX="20"
                                             RadiusY="20"/>
                                        </Image.Clip>
                                    </Image>
                                </Border>

                                <!-- 文本 -->
                                <StackPanel Grid.Column="1"
                                            Margin="10,0"
                                            VerticalAlignment="Center">
                                    <TextBlock Text="{Binding UserName}"
                                               FontSize="12"
                                               FontWeight="SemiBold"
                                               Foreground="#222"/>
                                    <TextBlock Text="在线"
                                               FontSize="12"
                                               Margin="0,5,0,0"
                                               Foreground="#666"
                                               MaxWidth="260"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Hover 触发器 -->
                        <DataTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root"
                                        Property="Background"
                                        Value="#EEE"/>
                            </Trigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>

            </ItemsControl>
        </ScrollViewer>
    </Grid>

</UserControl>
